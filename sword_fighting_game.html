<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Sword Fighting — Warrior Edition</title>
  <style>
    html,body{height:100%;margin:0;background:#0a0a0f;font-family:Inter,system-ui,Arial}
    #gameCanvas{display:block;width:100%;height:100vh}
    .overlay{
      position:fixed;left:12px;top:12px;color:#e6eef8;z-index:10;backdrop-filter: blur(4px);
      background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));padding:10px;border-radius:8px;
      box-shadow:0 6px 18px rgba(0,0,0,0.6);
    }
    .centerOverlay{position:fixed;left:50%;top:16px;transform:translateX(-50%);z-index:10;color:#fff;background:linear-gradient(180deg,#111 0%,#0c2233 100%);padding:10px 16px;border-radius:10px;font-weight:600}
    #hud{right:12px;left:auto;top:12px}
    .big{font-size:18px}
    .small{font-size:13px;opacity:0.9}
    #instructions{position:fixed;left:12px;bottom:12px;color:#cfe9ff;background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.1));padding:12px;border-radius:8px;z-index:10}
    #startButton{padding:8px 12px;border-radius:6px;border:0;background:#2b9fff;color:#fff;font-weight:700;cursor:pointer}
    #tips{margin-top:6px;font-size:12px;opacity:0.95}
    #message{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:11;color:#fff;padding:18px 22px;border-radius:12px;background:rgba(0,0,0,0.6);display:none}
    #controls{margin-top:8px}
    #footer{position:fixed;right:12px;bottom:12px;color:#9fb7d9;font-size:12px}
  </style>
</head>
<body>
  <div id="gameCanvas"></div>

  <div class="overlay" id="hud">
    <div class="big">Level: <span id="levelTxt">—</span></div>
    <div class="small">Health: <span id="hpTxt">100</span></div>
    <div style="margin-top:6px" class="small">Enemies: <span id="enemyCnt">0</span></div>
  </div>

  <div class="centerOverlay">3D Sword Fighting — Warrior Edition</div>

  <div id="instructions">
    <div style="font-weight:700">Controls</div>
    <div id="controls" class="small">W/A/S/D — Move &nbsp; • &nbsp; Mouse — Look &nbsp; • &nbsp; Left Click — Swing &nbsp; • &nbsp; Space — Dash</div>
    <div style="margin-top:8px"><button id="startButton">Start Game</button></div>
    <div id="tips">Tip: Swing your sword to defeat enemies. Watch out — they swing back!</div>
  </div>

  <div id="message"></div>
  <div id="footer">Made with Three.js — Single-file</div>

  <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
  <script>
  // === GAME VARS ===
  let scene, camera, renderer, clock;
  let player, enemies = [], keys = {};
  let level=0, kills=0, spawnTimer=0;
  let spawnRate=2.0, maxEnemies=5, targetKills=6;

  const canvasContainer = document.getElementById('gameCanvas');
  const levelTxt = document.getElementById('levelTxt');
  const hpTxt = document.getElementById('hpTxt');
  const enemyCnt = document.getElementById('enemyCnt');
  const messageEl = document.getElementById('message');
  const startButton = document.getElementById('startButton');

  // === SOUND EFFECTS ===
  const sounds = {
    swing: new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_d4a0fa2d1a.mp3?filename=sword-whoosh-1-110011.mp3"),
    hit: new Audio("https://cdn.pixabay.com/download/audio/2021/09/30/audio_c08d690d85.mp3?filename=sword-clash-110622.mp3"),
    damage: new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_6d8db94fdd.mp3?filename=sword-hit-110009.mp3")
  };
  Object.values(sounds).forEach(s=>{ s.volume=0.5 });

  init();

  function init(){
    scene = new THREE.Scene();
    clock = new THREE.Clock();

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(2,window.devicePixelRatio));
    canvasContainer.appendChild(renderer.domElement);

    camera = new THREE.PerspectiveCamera(65, window.innerWidth/window.innerHeight, 0.1, 2000);
    camera.position.set(0,2,6);

    // Lights
    scene.add(new THREE.HemisphereLight(0xceedff,0x222233,0.8));
    const dir = new THREE.DirectionalLight(0xffffff,0.8);
    dir.position.set(5,10,5); dir.castShadow=true; scene.add(dir);

    // Ground
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(300,300), new THREE.MeshStandardMaterial({color:0x22313a}));
    ground.rotation.x=-Math.PI/2; ground.receiveShadow=true; scene.add(ground);

    // Player
    player=createPlayer();
    scene.add(player.group);

    // Input
    setupInput();
    window.addEventListener('resize', onResize);

    animate();
  }

  function createSword(color=0xc0c0c0){
    const group=new THREE.Group();
    const blade=new THREE.Mesh(new THREE.BoxGeometry(0.15,2.2,0.1), new THREE.MeshStandardMaterial({color,metalness:1,roughness:0.2}));
    blade.position.y=1.1;
    const hilt=new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.08,0.5,8), new THREE.MeshStandardMaterial({color:0x333333}));
    hilt.position.y=-0.25;
    group.add(blade); group.add(hilt);
    return group;
  }

  function createPlayer(){
    const group=new THREE.Group();
    const torso=new THREE.Mesh(new THREE.CapsuleGeometry(0.5,1.2,4,8), new THREE.MeshStandardMaterial({color:0x5555ff}));
    torso.position.y=1.4; group.add(torso);
    const head=new THREE.Mesh(new THREE.SphereGeometry(0.35,16,16), new THREE.MeshStandardMaterial({color:0xffe0bd}));
    head.position.y=2.4; group.add(head);
    const arm=new THREE.Mesh(new THREE.CapsuleGeometry(0.15,0.6,4,8), new THREE.MeshStandardMaterial({color:0x5555ff}));
    arm.position.set(0.6,1.6,0); group.add(arm);

    const swordPivot=new THREE.Group();
    swordPivot.position.set(0.9,1.6,0);
    const sword=createSword(0xc0c0c0);
    swordPivot.add(sword);
    group.add(swordPivot);

    return {
      group,
      swordPivot,
      health:100,maxHealth:100,
      speed:7,
      swingCooldown:0.5,
      canSwing:true
    };
  }

  function createEnemy(){
    const group=new THREE.Group();
    const body=new THREE.Mesh(new THREE.CapsuleGeometry(0.35,0.8,4,8), new THREE.MeshStandardMaterial({color:0xaa4444}));
    body.position.y=1.2; group.add(body);
    const head=new THREE.Mesh(new THREE.SphereGeometry(0.25,12,12), new THREE.MeshStandardMaterial({color:0xffd0b0}));
    head.position.y=2; group.add(head);

    const swordPivot=new THREE.Group();
    swordPivot.position.set(0.6,1.6,0);
    const sword=createSword(0xbbbbbb);
    swordPivot.add(sword);
    group.add(swordPivot);

    return {group,swordPivot,health:25,speed:2.0,attackCooldown:1,attackTimer:0};
  }

  function setupInput(){
    window.addEventListener('keydown',(e)=>{ keys[e.key.toLowerCase()]=true; });
    window.addEventListener('keyup',(e)=>{ keys[e.key.toLowerCase()]=false; });
    window.addEventListener('mousedown',(e)=>{ if(e.button===0) swingSword(); });
    startButton.addEventListener('click',()=>{ if(level===0) startLevel(1); });
  }

  function startLevel(n){
    level=n;
    levelTxt.textContent=(n===1?"Easy":n===2?"Medium":"Hard");
    player.health=player.maxHealth;
    enemies.forEach(en=>scene.remove(en.group)); enemies=[];
    kills=0;
    spawnRate=(n===1?2.2:n===2?1.6:1.0);
    maxEnemies=(n===1?5:n===2?8:12);
    targetKills=(n===1?6:n===2?10:16);
    showMessage("Level "+n+" started!");
  }

  function showMessage(txt){
    messageEl.style.display="block"; messageEl.textContent=txt;
    setTimeout(()=>{ messageEl.style.display="none"; },2000);
  }

  function swingSword(){
    if(!player.canSwing||level===0) return;
    player.canSwing=false;
    player.swingProgress=0; player.swingHitApplied=false;
    sounds.swing.currentTime=0; sounds.swing.play();
  }

  function spawnEnemy(){
    const e=createEnemy();
    const angle=Math.random()*Math.PI*2, dist=12+Math.random()*6;
    e.group.position.set(Math.cos(angle)*dist,0,Math.sin(angle)*dist);
    scene.add(e.group); enemies.push(e);
  }

  function animate(){
    requestAnimationFrame(animate);
    const dt=Math.min(0.06, clock.getDelta());

    if(level>0){
      spawnTimer+=dt;
      if(spawnTimer>spawnRate && enemies.length<maxEnemies){ spawnTimer=0; spawnEnemy(); }

      // update enemies
      enemies.forEach((en,i)=>{
        const dir=new THREE.Vector3().subVectors(player.group.position,en.group.position);
        const dist=dir.length();
        if(dist>0.1) dir.normalize();
        if(dist>1.8) en.group.position.add(dir.multiplyScalar(en.speed*dt));
        else{
          en.attackTimer+=dt;
          if(en.attackTimer>en.attackCooldown){
            en.attackTimer=0;
            en.swingProgress=0; en.hitApplied=false;
            sounds.swing.currentTime=0; sounds.swing.play();
          }
        }

        // enemy swing animation
        if(en.swingProgress!==undefined){
          en.swingProgress+=dt*7.5;
          const prog=Math.min(en.swingProgress,1);
          if(en.swordPivot) en.swordPivot.rotation.z=Math.sin(prog*Math.PI)*1.0;
          if(!en.hitApplied && prog>0.4 && prog<0.6 && dist<2.2){
            en.hitApplied=true;
            player.health-=8;
            sounds.damage.currentTime=0; sounds.damage.play();
          }
          if(en.swingProgress>=1.0) en.swingProgress=undefined;
        }

        if(en.health<=0){ scene.remove(en.group); enemies.splice(i,1); kills++; if(kills>=targetKills) startLevel(level+1); }
      });

      // player swing
      if(player.swingProgress!==undefined){
        player.swingProgress+=dt*9.5;
        const prog=Math.min(player.swingProgress,1);
        player.swordPivot.rotation.z=Math.sin(prog*Math.PI)*1.6;
        if(!player.swingHitApplied && prog>0.38 && prog<0.68){
          player.swingHitApplied=true;
          enemies.forEach(en=>{
            const d=en.group.position.distanceTo(player.group.position);
            if(d<2.5){
              en.health-=15;
              sounds.hit.currentTime=0; sounds.hit.play();
            }
          });
        }
        if(player.swingProgress>=1.0){ player.swingProgress=undefined; player.canSwing=true; player.swingHitApplied=false; }
      }

      // movement
      const forward=new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
      const right=new THREE.Vector3(1,0,0).applyQuaternion(camera.quaternion);
      const vel=new THREE.Vector3();
      if(keys['w']) vel.add(forward);
      if(keys['s']) vel.sub(forward);
      if(keys['a']) vel.sub(right);
      if(keys['d']) vel.add(right);
      vel.y=0;
      if(vel.length()>0) vel.normalize().multiplyScalar(player.speed*dt);
      player.group.position.add(vel);
      if(keys[' ']) player.group.position.add(forward.multiplyScalar(player.speed*dt*2));

      // HUD
      hpTxt.textContent=Math.max(0,Math.round(player.health));
      enemyCnt.textContent=enemies.length;
      if(player.health<=0){ showMessage("You died! Click Start to retry."); level=0; }
    }

    camera.position.lerp(new THREE.Vector3(player.group.position.x,player.group.position.y+2,player.group.position.z+6),0.1);
    camera.lookAt(player.group.position.x,player.group.position.y+1.5,player.group.position.z);
    renderer.render(scene,camera);
  }

  function onResize(){
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  }
  </script>
</body>
</html>
